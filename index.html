<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #e8f0ff, #fdfcff, #e8faff);
      min-height: 100vh;
      color: #333;
    }

    header {
      background:rgba(255,255,255,0.65);
      backdrop-filter: blur(10px);
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.07);
      display: flex;
      justify-content: center; /* space-between; */
      align-items: center;
    }
    .header-container {
      display: flex;
      justify-content: center; /* space-between; */
      align-items: center;
      gap: 15px;
      width: 100%;
    }
    .Title {
      display: flex;
      flex-direction: column;
      /* flex-wrap: wrap; */
      justify-content: center;
      align-items: center;
      gap: 15px;
      padding: 15px 12px;
      background:linear-gradient(90deg, #e8f6ff, #fafdff);
      border-bottom: 2px solid #d6eaff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    /* style="display: flex; flex-direction: column;" */
    .brand {
      /* font-size: 22px; */
      /* font-weight: bold; */
      display: flex;
      flex-direction: row;
      justify-content: center;
      /* color: #2e3c88; */
      margin: 0;
      font-size: 2.0rem;
      font-weight: 700;
      color: #234b6f;
      line-height: 1.2;
      
    }
    .tagline {
        font-size: 0.9rem;
        color: #507a9b;
        justify-content: center;
        text-align: center;
      }
    /* style="
      margin: 0;
      font-size: 2.5rem;
      font-weight: 700;
      color: #234b6f;
      line-height: 1.2;
    " */
    .support-buttons a {
      margin-left: 10px;
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 6px;
      color: white;
      font-weight: bold;
    }
    /* Support button designs with logos */
    .support-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: transform 0.15s;
    }
    .analytics-counters {
      display: flex;
      gap: 20px;
      margin-left: 30px;
      font-size: 14px;
      color: #555;
      justify-content: center;
      text-align: center;
    }
    .support-btn:hover {
      transform: translateY(-2px);
    }

    .support-logo {
      width: 20px;
      height: 20px;
    }

    /* Colors */
    .bmc { background: #FFDD00; color: black !important; }
    .patreon { background: #f96854; color: white !important; }

    /* Large support section */
    .support-card {
      margin-top: 40px;
      border-left: 5px solid #ffaf40;
    }

    .support-text {
      color: #444;
      margin-bottom: 20px;
      font-size: 15px;
    }

    .support-buttons-large {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
    }

    .card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(8px);
      padding: 25px;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
      margin-bottom: 28px;
      border-left: 5px solid #4a73ff;
      transition: 0.25s;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 22px rgba(0,0,0,0.1);
    }

    h2 { margin-top: 0; color: #2a357a; }
    h3 { margin-top: 0; color: #2a7a37; justify-content: center; text-align: center;font-style: bold; }
    p { line-height: 1.6; color: black; font-weight: bold; font-size: 1.0em;}

    .category-title {
      margin: 10px 0 5px 0;
      font-weight: bold;
      color: #4a4a4a;
      padding-bottom: 3px;
      border-bottom: 2px solid #d0d7ff;
      /*max-width: 260px;*/
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .param {
      flex: 1;
      min-width: 220px;
      /*max-width: 260px;*/
      margin-right: 18px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
    }
    .smaller-param { max-width: 220px;display: flex; }

    label { font-weight: bold;min-width: 280px; }
    .hint { font-size: 12px; opacity: 0.7; max-width: 250px ; }

    input, select {
      width: 100%;
      padding: 2px;
      margin-top: 4px;
      border-radius: 6px;
      border: 2px solid #c7d2f2;
      font-size: 0.95rem;
    }

    button {
      padding: 12px 20px;
      background: #0a0a0a;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-style: bold;
      cursor: pointer;
      margin-top: 10px;
      /* display: flex; */
      /* flex-wrap: wrap; */
      /* flex-direction: column; */
      justify-content: center;
      text-align: center;
      width: auto;
      gap: 20px;
    }
    .button-row {
        display: flex;
        justify-content: center;
        gap: 18px;
        margin: 18px 0;
    }
    /*style="display: flex; justify-content: center; width: 100%; gap: 20px;"*/
    button:hover { background: #2f59f7; }

    .plot-card {
      padding: 20px;
      background: #fafafa;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #e4e4e4;
    }

    .export-buttons button {
      background: #555;
      margin-right: 10px;
    }
    .logo {
      height: 200px;
      width: auto;
      border-radius: 15px;
    }
    /* ---------------- FOOTER ---------------- */
    footer {
      margin-top: 20px;
      padding: 20px;
      text-align: center;
      color: #555;
      font-size: 14px;
    }

    footer span {
      opacity: 0.7;
    }
    /* ---------------- MOBILE OPTIMIZATION ---------------- */
    @media (max-width: 600px) {
      .brand { 
        font-size: 1.9rem;
        line-height: 2.1rem; 
      }
      .Title {
        padding: 10px 12px;
        gap: 10px;
      } 
      .tagline {
        font-size: 0.9rem;
        color: #507a9b;
        justify-content: center;
        text-align: center;
      }
      .card {
        padding: 16px;
        font-size: 0.95rem;
        line-height: 1.35rem;
      }
      .card p {
        margin-bottom: 10px;
      }

      button {
        width: 100%;
      }

      header {
        padding: 10px 12px;
      }
      /* header h1 {
        font-size: 0.5rem;
        line-height: 2.1rem;
      }
      header p {
        font-size: 0.95rem;
        margin-top: 4px;
      } */
      .logo {
        display: flex;
        height: 120px;
        width: 100%;
        border-radius: 15px;
      }
      .analytics-counters {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 6px;
        font-size: 0.9rem !important;
    }
    

      .plot-card {
        padding: 12px;
        font-style: bold;
        justify-content: center;
        text-align: center;
      }

    /* Button row */
    .button-row {
        display: flex;
        justify-content: center;
        gap: 18px;
        margin: 18px 0;
    }

    .button-row button {
        padding: 12px 20px;
        font-size: 1rem;
        border-radius: 10px;
    }

    /* Results card */
    #results-card {
        margin-top: 12px !important;
        padding-top: 10px !important;
    }

    /* Plot cards */
    .plot-card {
        padding: 12px !important;
        margin-bottom: 22px !important;
    }

    .plot-card h3 {
        margin-bottom: 10px !important;
        font-size: 1.3rem !important;
        text-align: center;
    }

    /* Shrink Plotly toolbar on mobile */
    .js-plotly-plot .modebar {
        transform: scale(0.8);
        right: 0;
    }

    }
  </style>
</head>

<body>

<!-- <header>
  
  <div class="Title">
    <img
    src="logo.jpg" 
    alt="Financial Freedom Logo"
    class =logo>
    <h1 class="brand">
      Financial Independence Simulator
    </h1>
      <span style="
      font-size: 0.9rem;
      color: #507a9b;
      justify-content: center;
      text-align: center;">
      Plan your future. Live your dream.
    </span>
    
    <div class="analytics-counters">
      <p>üëÅ Total Visits: <span id="visitCount">0</span></p>
      <p>‚öô  Simulation Runs: <span id="simRunCount">0</span></p>
  </div>
  <img 
    src="logo.jpg" 
    alt="Financial Freedom Logo"
    class =logo>
  </div>
</header> -->
<header>
  <div class="header-container">

    <!-- LEFT IMAGE -->
    <img 
      src="logo.jpg" 
      alt="Financial Freedom Logo"
      class="logo"
    >

    <!-- CENTER TITLE BLOCK -->
    <div class="Title">
      <h1 class="brand">Financial Independence Simulator</h1>

      <span class="tagline">
        Plan your future. Live your dream.
      </span>

      <div class="analytics-counters">
        <p>üëÅ Total Visits: <span id="visitCount">0</span></p>
        <p>‚öô Simulation Runs: <span id="simRunCount">0</span></p>
      </div>
    </div>

    <!-- RIGHT IMAGE -->
    <img 
      src="logo.jpg" 
      alt="Financial Freedom Logo"
      class="logo"
    >
  </div>
</header>

<div class="container">

  <!-- INTRO CARD -->
  <div class="card">
    <h2>About This Simulation</h2>
    <p>
      ever wandered wether you're fit to go financially independent?<br>
      this tool aims to put trinity and 4% rules to the practical test tailored to your unique financial situation (initial fortune, monthly lifestyle expenses, passive incomes etc).
      <br>by applying monte carlo simulations, it models how your portfolio might evolve under various market conditions and withdrawal strategies for period of years
      and let you get a clear picture of your readiness to achieve financial independence.
      <br>just input your parameters, run the simulation, and explore the results to make informed decisions about your financial future.
    </p>
  </div>

  <!-- PARAMETERS CARD -->
  <div class="card">
    <h2>Simulation Parameters</h2>

    <!-- CATEGORY 1 -->
    <div class="category-title">Simulation Parameters</div>
    <div class="row">

      <div class="param">
        <label>Number of Simulation Runs</label>
        <input id="sim_runs" type="number" value="500" class="sim_input">
        <div class="hint">Typical: 300‚Äì1000</div>
      </div>

      <div class="param">
        <label>Simulation Period (Years)</label>
        <input id="sim_years" type="number" value="30" class="sim_input">
        <div class="hint">Typical: 20‚Äì40 years</div>
      </div>

      <div class="param">
        <label>Inflation Rate (%)</label>
        <input id="inflation" type="number" step="0.1" value="2.5" class="sim_input">
        <div class="hint">Typical: 2‚Äì3%</div>
      </div>

      <div class="param">
        <label>Withdrawal Mode</label>
        <select id="withdraw_mode" class="sim_input">
          <option value="normal">Unrestricted</option>
          <option value="keep_nominal">Keep Nominal Initial Fortune</option>
          <option value="keep_real">Keep Real Initial Fortune</option>
        </select>
        <div class="hint">Unrestricted: withdrawal as needed without restriction<br>
          Keep Nominal: withdrawal limited to initial nominal fortune<br>
          Keep Real: withdrawal limited to initial real fortune</div>
      </div>
    </div>

    <!-- CATEGORY 2 -->
    <div class="category-title">Cash Flow Parameters</div>
    <div class="row">

      <div class="param">
        <label>Passive Income (Monthly)</label>
        <input id="passive_income" type="number" value="0" class ="sim_input">
        <div class="hint">e.g. partner income/rent/dividends/other</div>
      </div>

      <div class="param">
        <label>Monthly Expenses</label>
        <input id="monthly_expenses" type="number" value="32000" class ="sim_input">
        <div class="hint">Your average monthly expenses according to your desired lifestyle</div>
      </div>

      <div class="param">
        <label>Accommodation Expenses (Monthly)</label>
        <input id="rent" type="number" value="10000" class ="sim_input">
        <div class="hint">Rental expenses seperated from monthly lifestyle expenses<br>
          (not coupled to yearly inflation rate - assuming long term rental contract)</div>
      </div>
    </div>

    <!-- CATEGORY 3 -->
    <div class="category-title">Capital Parameters</div>
    <div class="row">

      <div class="param">
        <label>Initial Fortune</label>
        <input id="initial_fortune" type="number" value="3000000" class ="sim_input">
        <div class="hint">Your current investable capital as a working point to examine the capability of achieving financial independence</div>
      </div>

      <div class="param">
        <label>Portfolio Split</label>
        <input id="portfolio_split" type="number" step="0.1" value="0.6" max="1" min="0" class ="sim_input">
        <div class="hint">Proportion of solid (lower return, lower volatility) assets vs risky assets (higher return, higher volatility) in your portfolio</div>
      </div>
      
      <div class="param">
        <label>Capital Tax (%)</label>
        <input id="tax" type="number" step="0.1" value="25" class="sim_input">
        <div class="hint">Tax rate applied to capital gains on withdrawals<br>
        Typical: 20‚Äì30% depending on your country and tax situation</div>
      </div>
      </div>
      <div class="row">
      <div class="param">
        <label>Solid: Annual Avg Return Mean (%)</label>
        <input id="solid_mean" type="number" step="0.1" value="4" min="0" class ="sim_input">
        <div class="hint">Expected average annual return of solid assets (e.g. bonds, debentures, investments deposits etc)<br>
        Typical: 2‚Äì5% according to central banks interest rates</div>
      </div>

      <div class="param">
        <label>Solid: Annual Return Std (%)</label>
        <input id="solid_std"  type="number" step="0.1" value="0.5" min="0" class ="sim_input">
        <div class="hint">Expected annual return volatility of solid assets<br>
        Typical: 0.5‚Äì2% according to historical data of bonds and similar assets</div>
      </div>

      <div class="param">
        <label>Risky: Annual Avg Return Mean (%)</label>
        <input id="risky_mean" type="number" step="0.1" value="10" min="0" max="20" class ="sim_input">
        <div class="hint">Expected average annual return of risky assets (e.g. s&p500, ETF's etc.)<br>
        Typical: 8‚Äì12% referred to s&p500 historical returns</div>
      </div>

      <div class="param">
        <label>Risky: Annual Return Std (%)</label>
        <input id="risky_std"  type="number" step="0.1" value="15" class ="sim_input">
        <div class="hint">Expected annual return volatility of risky assets<br>
        Typical: 10‚Äì20% according to historical data of s&p500 and similar assets</div>
      </div>
    </div>

    <!--<button onclick="runSim()">Run Simulation</button>-->
    <div class="button-row">
      <button class="sim-button" style="background-color: #05d0f4; color: white;" onclick="runSim()">Run Simulation</button>
      <button class="sim-button" style="background-color: #ff4d4d; color: white;" onclick="localStorage.clear();location.reload()">Reset Params</button>
    </div>
  </div>

  <!-- RESULTS CARD (HIDDEN INITIALLY) -->
  <div id="results-card" class="card" style="display:none;">

    <h2>Simulation Results</h2>

    <div class="export-buttons">
      <button onclick="exportExcel()">Export Excel</button>
    </div>

    <div class="plot-card">
      <h3>Portfolio Progresssion</h3>
      <div id="plot1" style="width:100%; height:400px"></div>
    </div>

    <div class="plot-card">
      <h3>Cash Balance Progression</h3>
      <div id="plot2" style="width:100%; height:400px"></div>
    </div>

    <div class="plot-card">
      <h3>Monthly Returns (%)</h3>
      <div id="plot3" style="width:100%; height:400px"></div>
    </div>

    <div class="plot-card">
      <h3>Withdrawal Progression</h3>
      <div id="plot4" style="width:100%; height:400px"></div>
    </div>

  </div>

<div class="card support-card">
  <h2>Support Future Development üíõ</h2>
  <p class="support-text">
    If this tool helped you evaluate your financial independence scenario,
    consider supporting the ongoing development.  
    Your contribution helps add more features, improve accuracy,
    and keep this tool free for everyone.  
    every dollar counts and much appreciated üòä<br>Thank you! üôè
  </p>

  <div class="support-buttons-large">
    <a class="support-btn bmc" href="https://buymeacoffee.com/naorco" target="_blank">
      <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" class="support-logo">
      <span>Buy Me a Coffee</span>
    </a>

    <!-- <a class="support-btn patreon" href="https://patreon.com/YOURNAME" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/9/94/Patreon_logo.svg" class="support-logo">
      <span>Patreon</span>
    </a> -->
  </div>
</div>

</div>
<footer>
  <span>¬© 2026 Financial Independence Simulator ‚Ä¢ Developed by N C</span>
</footer>

<script>
loadSimAnalytics();
loadVisitorsAnalytics();
let lastSimData = null;

async function runSim() {

    const payload = {
        SimParams: {
            numSim: parseInt(sim_runs.value),
            numYears: parseInt(sim_years.value),
            inflationRate: parseFloat(inflation.value/100),
            mode: withdraw_mode.value
        },
        CashFlowParams: {
            income: parseInt(passive_income.value),
            expenses: parseInt(monthly_expenses.value),
            rent: parseInt(rent.value)
        },
        CapitalParams: {
            initialFortune: parseInt(initial_fortune.value),
            portfolioRatio: parseFloat(portfolio_split.value),
            solidMean: parseFloat(solid_mean.value/100),
            solidStd: parseFloat(solid_std.value/100),
            stocksMean: parseFloat(risky_mean.value/100),
            stocksStd: parseFloat(risky_std.value/100),
            taxRate: parseFloat(tax.value/100)
        }
    };

    try {
        
        const res = await fetch("https://financesim-proxy.onrender.com/FinanceFreedomSim", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    // ---- Handle HTTP errors (403, 500, etc) ----
    if (!res.ok) {
        const errorText = await res.text(); // read server error message
        throw new Error(`Server error ${res.status}: ${errorText}`);
    }
    
    
    const data = await res.json();
    lastSimData = data;

    document.getElementById("results-card").style.display = "block";

    Plotly.newPlot("plot1", [
      { x: data.months, y: data.lAvgInitialFortune, name: "Initial Fortune Coupled to Inflation" },
      { x: data.months, y: data.lAvgPortfolio, name: "Average Portfolio Value" }],{xaxis: {title: "Months"}, yaxis: {title: "Value"}})
      //{ title: "Portfolio Progression" });
    Plotly.newPlot("plot2", [{ x: data.months, y: data.lAvgCashBalance, name: "Average Cash Balance" }],{xaxis: {title: "Months"}, yaxis: {title: "Value"}})//, { title: "Cash Balance" });
    Plotly.newPlot("plot3", [
        { x: data.months, y: data.lAvgSolidReturn, name: "Solid Returns" },
        { x: data.months, y: data.lAvgStocksReturn, name: "Risky Returns" }
    ],{xaxis: {title: "Months"}, yaxis: {title: "Returns (%)"}})//, { title: "Monthly Returns (%)" });
    Plotly.newPlot("plot4", [
      { x: data.months, y: data.lAvgWithdrawal, name: "Withdrawal Before Tax" },
      {x: data.months, y: data.lAvgRecieved, name: "Net Withdrawal Actually recieved After Tax" }],
      {xaxis: {title: "Months"}, yaxis: {title: "Value"}})
      //,{ title: "Withdrawal Progression" });

      // refresh analytics after sim run
      loadSimAnalytics();
    } catch (err) {
            alert(`Error: ${err.message}`);
            console.error("Simulation error:", err);
            showError(err.message);
        }
}

function exportExcel() {
    if (!lastSimData || !lastSimData.months) {
        alert("No simulation data available.");
        return;
    }

    const wb = XLSX.utils.book_new();

    const months = lastSimData.months;     // shared X values
    const sheetRows = [];

    // Build the header row: ["Metric", 0,1,2,3,...]
    const header = ["Months", ...months];
    sheetRows.push(header);

    // Add one row per metric
    Object.keys(lastSimData).forEach(name => {
        if (name === "months") return;

        const yvals = lastSimData[name];

        // Row format: ["metricName", v0, v1, v2, ...]
        sheetRows.push([name, ...yvals]);
    });

    // Convert to sheet
    const ws = XLSX.utils.aoa_to_sheet(sheetRows);
    XLSX.utils.book_append_sheet(wb, ws, "Simulation");

    XLSX.writeFile(wb, "simulation.xlsx");
  }

async function loadSimAnalytics() {
    try {
        const res = await fetch('https://financesim-proxy.onrender.com/SimAnalytics', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!res.ok) {
            console.error("Server returned error:", res.status);
            return;
        }

        const data = await res.json();
        document.getElementById("simRunCount").innerText = data;

        
    } catch (err) {
        console.error("Failed reading sim analytics:", err);
    }
}

async function loadVisitorsAnalytics() {
    try {
        
        // load visit count as well
        const res = await fetch('https://financesim-proxy.onrender.com/VisitorsAnalytics', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!res.ok) {
            console.error("Server returned error:", res.status);
            return;
        }

        const data = await res.json();
        document.getElementById("visitCount").innerText = data;
    } catch (err) {
        console.error("Failed reading sim analytics:", err);
    }
}
</script>
<script>
// restore parameters on page load
window.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll(".sim_input");

    inputs.forEach(input => {
        const saved = localStorage.getItem("simparam_" + input.id);
        if (saved !== null) {
            if (input.type === "number") {
                input.value = Number(saved);
            } else {
                input.value = saved;
            }
        }

        // auto-save on change
        input.addEventListener("input", () => {
            localStorage.setItem("simparam_" + input.id, input.value);
        });
    });
});
</script>
</body>
</html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Open Graph for WhatsApp / Facebook -->
  <meta property="og:title" content="Financial Independence Simulator" />
  <meta property="og:description" content="Plan your financial future with simulations, projections, and smart analytics." />
  <meta property="og:image" content="https://naorco.github.io/FinanceIndependenceFrontend/logo.jpg" />
  <meta property="og:url" content="https://naorco.github.io/FinanceIndependenceFrontend/" />
  <meta property="og:type" content="website" />
  <!-- Twitter card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Financial Independence Simulator">
  <meta name="twitter:description" content="Plan your financial future with interactive simulations.">
  <meta name="twitter:image" content="https://naorco.github.io/FinanceIndependenceFrontend/logo.jpg">

  <meta name="description" content="Interactive financial independence calculator and simulator. Build projections, run scenarios, and plan your FIRE future.">
  <meta name="keywords" content="financial independence, FIRE calculator, retirement simulator, finance, savings, investing">
  <meta name="author" content="Naor Cohen">
  <meta name="theme-color" content="#5A38F0" />

  <title>Financial Independence Simulator</title>
  <link rel="icon" href="/favicon_io/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="favicon_io/favicon-16x16.png" type="image/png" sizes="16x16" />
  <link rel="icon" href="/favicon_io/favicon-32x32.png" type="image/png" sizes="32x32" />
  <link rel="icon" href="/favicon_io/favicon-192x192.png" type="image/png" sizes="192x192" />
  <link rel="icon" href="/favicon_io/favicon-512x512.png" type="image/png" sizes="512x512" />

  <link rel="stylesheet" href="theme.css">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"> -->
  
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Financial Independence Simulator",
  "url": "https://naorco.github.io/FinanceIndependenceFrontend/",
  "description": "Interactive financial independence calculator and FIRE projection simulator.",
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All"
}
</script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
</head>

<body>


<header>
  <div class="header-container">

    <!-- LEFT IMAGE -->

    <!-- CENTER TITLE BLOCK -->
    <div class="Title">
      
      <h1 class="brand">Financial Independence Simulator</h1>
      <img 
      src="logo.jpg" 
      alt="Financial Freedom Logo"
      class="logo"
    >
      <span class="tagline">
        Plan your future. Live your dream.
      </span>

      <div class="analytics-counters">
        <span id="backend-indicator" class = "status-dot red"></span>
        <!-- <span id="backend-status-text">Checking...</span> -->
        <p>üëÅ Total Visits: <span id="visitCount">0</span></p>
        <p>‚öô Simulation Runs: <span id="simRunCount">0</span></p>
      </div>
      
    </div>
  </div>
  <!-- Hidden card -->
      <div id="backend-down-card" class="backend-down" >
          <h3>‚è≥ Server Warming Up</h3>
          <p>
              My backend services are hosted on free-tier infrastructure.  
              When there's no traffic for a while, they temporarily go to sleep.  
              It normally takes <b>1‚Äì2 minutes</b> for them to fully wake up.
          </p>
          <p style="text-align: center;">Please try again shortly.</p>
      </div>
</header>

<div class="container">

  <!-- INTRO CARD -->
  <div class="card">
    <h2>About This Simulation</h2>
    <p>
      Ever wandered wether you're fit to go financially independent?<br>
      this tool aims to put trinity and 4% rules to the practical test tailored to your unique financial situation (initial fortune, monthly lifestyle expenses, passive incomes etc).
      <br>by applying monte carlo simulations, it models how your portfolio might evolve under various market conditions and withdrawal strategies for period of years
      and let you get a clear picture of your readiness to achieve financial independence.
      <br>just input your parameters, run the simulation, and explore the results to make informed decisions about your financial future.
    </p>
  </div>

  <!-- PARAMETERS CARD -->
  <div class="card">
    <h2>Simulation Parameters</h2>

    <!-- CATEGORY 1 -->
    <div class="category-title">Simulation Parameters</div>
    <div class="row">

      <div class="param">
        <label>Number of Simulation Runs</label>
        <input id="sim_runs" type="number" value="10" max="100" min="1" class="sim_input">
        <div class="hint">Typical: 1 - 100</div>
      </div>

      <div class="param">
        <label>Simulation Period (Years)</label>
        <input id="sim_years" type="number" value="30" class="sim_input">
        <div class="hint">Typical: 20‚Äì40 years</div>
      </div>

      <div class="param">
        <label>Inflation Rate (%)</label>
        <input id="inflation" type="number" step="0.1" value="2.5" class="sim_input">
        <div class="hint">Typical: 2‚Äì3%</div>
      </div>

      <div class="param">
        <label>Withdrawal Mode</label>
        <select id="withdraw_mode" class="sim_input">
          <option value="normal">Unrestricted</option>
          <option value="keep_nominal">Keep Nominal Initial Fortune</option>
          <option value="keep_real">Keep Real Initial Fortune</option>
        </select>
        <div class="hint">Unrestricted: withdrawal as needed without restriction<br>
          Keep Nominal: withdrawal limited to initial nominal fortune<br>
          Keep Real: withdrawal limited to initial real fortune</div>
      </div>
    </div>

    <!-- CATEGORY 2 -->
    <div class="category-title">Cash Flow Parameters</div>
    <div class="row">

      <div class="param">
        <label>Passive Income (Monthly)</label>
        <input id="passive_income" type="number" value="0" class ="sim_input">
        <div class="hint">e.g. partner income/rent/dividends/other</div>
      </div>

      <div class="param">
        <label>Monthly Expenses</label>
        <input id="monthly_expenses" type="number" value="32000" class ="sim_input">
        <div class="hint">Your average monthly expenses according to your desired lifestyle</div>
      </div>

      <div class="param">
        <label>Accommodation Expenses (Monthly)</label>
        <input id="rent" type="number" value="10000" class ="sim_input">
        <div class="hint">Rental expenses seperated from monthly lifestyle expenses<br>
          (not coupled to yearly inflation rate - assuming long term rental contract)</div>
      </div>
    </div>

    <!-- CATEGORY 3 -->
    <div class="category-title">Capital Parameters</div>
    <div class="row">

      <div class="param">
        <label>Initial Fortune</label>
        <input id="initial_fortune" type="number" value="3000000" class ="sim_input">
        <div class="hint">Your current investable capital as a working point to examine the capability of achieving financial independence</div>
      </div>

      <div class="param">
        <label>Portfolio Split</label>
        <input id="portfolio_split" type="number" step="0.1" value="0.6" max="1" min="0" class ="sim_input">
        <div class="hint">Proportion of solid (lower return, lower volatility) assets vs risky assets (higher return, higher volatility) in your portfolio</div>
      </div>
      
      <div class="param">
        <label>Capital Tax (%)</label>
        <input id="tax" type="number" step="0.1" value="25" class="sim_input">
        <div class="hint">Tax rate applied to capital gains on withdrawals<br>
        Typical: 20‚Äì30% depending on your country and tax situation</div>
      </div>
      </div>
      <div class="row">
      <div class="param">
        <label>Solid: Annual Avg Return Mean (%)</label>
        <input id="solid_mean" type="number" step="0.1" value="4" min="0" class ="sim_input">
        <div class="hint">Expected average annual return of solid assets (e.g. bonds, debentures, investments deposits etc)<br>
        Typical: 2‚Äì5% according to central banks interest rates</div>
      </div>

      <div class="param">
        <label>Solid: Annual Return Std (%)</label>
        <input id="solid_std"  type="number" step="0.1" value="0.5" min="0" class ="sim_input">
        <div class="hint">Expected annual return volatility of solid assets<br>
        Typical: 0.5‚Äì2% according to historical data of bonds and similar assets</div>
      </div>

      <div class="param">
        <label>Risky: Annual Avg Return Mean (%)</label>
        <input id="risky_mean" type="number" step="0.1" value="10" min="0" max="20" class ="sim_input">
        <div class="hint">Expected average annual return of risky assets (e.g. s&p500, ETF's etc.)<br>
        Typical: 8‚Äì12% referred to s&p500 historical returns</div>
      </div>

      <div class="param">
        <label>Risky: Annual Return Std (%)</label>
        <input id="risky_std"  type="number" step="0.1" value="15" class ="sim_input">
        <div class="hint">Expected annual return volatility of risky assets<br>
        Typical: 10‚Äì20% according to historical data of s&p500 and similar assets</div>
      </div>
    </div>

    <!--<button onclick="runSim()">Run Simulation</button>-->
    <div class="button-row">
      <button class="sim-button" style="background-color: #05d0f4; color: white;" onclick="runSim()">Run Simulation</button>
      <button class="sim-button" style="background-color: #ff4d4d; color: white;" onclick="localStorage.clear();location.reload()">Reset Params</button>
    </div>
  </div>

  <!-- RESULTS CARD (HIDDEN INITIALLY) -->
  <div id="results-card" class="card" style="display:none;">

    <h2>Simulation Results</h2>

    <div class="export-buttons">
      <button onclick="exportExcel()">Export Excel</button>
    </div>

    <div class="plot-card">
      <h3>Portfolio Progresssion</h3>
      <div id="plot1" style="width:100%;"></div>
    </div>

    <div class="plot-card">
      <h3>Cash Balance Progression</h3>
      <div id="plot2" style="width:100%;"></div>
    </div>

    <div class="plot-card">
      <h3>Portfolio Monthly Returns (%)</h3>
      <div id="plot3" style="width:100%;"></div>
    </div>

    <div class="plot-card">
      <h3>Withdrawal Progression</h3>
      <div id="plot4" style="width:100%;"></div>
    </div>

  </div>

<div class="card support-card">
  <h2>Support Future Development üíõ</h2>
  <p class="support-text">
    If this tool helped you evaluate your financial independence scenario,
    consider supporting the ongoing development.  
    Your contribution helps add more features, improve accuracy,
    and keep this tool free for everyone.  
    every dollar counts and much appreciated üòä<br>Thank you! üôè
  </p>

  <div class="support-buttons-large">
    <a class="support-btn bmc" href="https://buymeacoffee.com/naorco" target="_blank">
      <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" class="support-logo">
      <span>Buy Me a Coffee</span>
    </a>

    <!-- <a class="support-btn patreon" href="https://patreon.com/YOURNAME" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/9/94/Patreon_logo.svg" class="support-logo">
      <span>Patreon</span>
    </a> -->
  </div>
</div>

</div>
<footer>
  <span>¬© 2026 Financial Independence Simulator ‚Ä¢ Developed by N C</span>
</footer>

<script>
  const SimURL = "https://financesim-proxy.onrender.com/FinanceFreedomSim";
  const SimAnalyticsURL = "https://financesim-proxy.onrender.com/SimAnalytics";
  const VisitorsAnalyticsURL = "https://financesim-proxy.onrender.com/VisitorsAnalytics";
  const backendHealthURL = "https://financesim-proxy.onrender.com/Health";
  // const SimURL = "http://127.0.0.1:8000/FinanceFreedomSim";
  // const SimAnalyticsURL = "http://127.0.0.1:8000/SimAnalytics";
  // const VisitorsAnalyticsURL = "http://127.0.0.1:8000/VisitorsAnalytics";
  // const backendHealthURL = "http://127.0.0.1:8000/Health";

// Immediately check when page loads
checkBackend();
// Optional: recheck every 15 seconds
setInterval(checkBackend, 15000);

loadSimAnalytics();
loadVisitorsAnalytics();

let lastSimData = null;

async function runSim() {

    const payload = {
        SimParams: {
            numSim: parseInt(sim_runs.value),
            numYears: parseInt(sim_years.value),
            inflationRate: parseFloat(inflation.value/100),
            mode: withdraw_mode.value
        },
        CashFlowParams: {
            income: parseInt(passive_income.value),
            expenses: parseInt(monthly_expenses.value),
            rent: parseInt(rent.value)
        },
        CapitalParams: {
            initialFortune: parseInt(initial_fortune.value),
            portfolioRatio: parseFloat(portfolio_split.value),
            solidMean: parseFloat(solid_mean.value/100),
            solidStd: parseFloat(solid_std.value/100),
            stocksMean: parseFloat(risky_mean.value/100),
            stocksStd: parseFloat(risky_std.value/100),
            taxRate: parseFloat(tax.value/100)
        }
    };

    try {
        
        const res = await fetch(SimURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    // ---- Handle HTTP errors (403, 500, etc) ----
    if (!res.ok) {
        const errorText = await res.text(); // read server error message
        throw new Error(`Server error ${res.status}: ${errorText}`);
    }
    
    
    const data = await res.json();
    lastSimData = data;

    document.getElementById("results-card").style.display = "block";
    const layout = {
    autosize: true,
    margin: { l: 40, r: 20, t: 40, b: 40 },
    legend: {
        orientation: "h",
        yanchor: "bottom",
        y: -0.3,
        xanchor: "center",
        x: 0.5
    }
};

    Plotly.newPlot("plot1", [
      { x: data.months, y: data.lAvgInitialFortune, name: "Initial Fortune Coupled to Inflation" },
      { x: data.months, y: data.lAvgPortfolio, name: "Average Portfolio Value" }],
      layout,{xaxis: {title: "Months"}, yaxis: {title: "Value"}})
      //{ title: "Portfolio Progression" });
    Plotly.newPlot("plot2", [{ x: data.months, y: data.lAvgCashBalance, name: "Average Cash Balance" }],
    layout,{xaxis: {title: "Months"}, yaxis: {title: "Value"}})//, { title: "Cash Balance" });
    Plotly.newPlot("plot3", [
        { x: data.months, y: data.lAvgSolidReturn, name: "Solid Returns" },
        { x: data.months, y: data.lAvgStocksReturn, name: "Risky Returns" }
    ],layout,{xaxis: {title: "Months"}, yaxis: {title: "Returns (%)"}})//, { title: "Monthly Returns (%)" });
    Plotly.newPlot("plot4", [
      { x: data.months, y: data.lAvgWithdrawal, name: "Withdrawal Before Tax" },
      {x: data.months, y: data.lAvgRecieved, name: "Net Withdrawal Actually recieved After Tax" }],layout,
      {xaxis: {title: "Months"}, yaxis: {title: "Value"}})
      //,{ title: "Withdrawal Progression" });

      // refresh analytics after sim run
      loadSimAnalytics();
    } catch (err) {
            alert(`Error: ${err.message}`);
            console.error("Simulation error:", err);
            showError(err.message);
        }
}

function exportExcel() {
    if (!lastSimData || !lastSimData.months) {
        alert("No simulation data available.");
        return;
    }

    const wb = XLSX.utils.book_new();

    const months = lastSimData.months;     // shared X values
    const sheetRows = [];

    // Build the header row: ["Metric", 0,1,2,3,...]
    const header = ["Months", ...months];
    sheetRows.push(header);

    // Add one row per metric
    Object.keys(lastSimData).forEach(name => {
        if (name === "months") return;

        const yvals = lastSimData[name];

        // Row format: ["metricName", v0, v1, v2, ...]
        sheetRows.push([name, ...yvals]);
    });

    // Convert to sheet
    const ws = XLSX.utils.aoa_to_sheet(sheetRows);
    XLSX.utils.book_append_sheet(wb, ws, "Simulation");

    XLSX.writeFile(wb, "simulation.xlsx");
  }

async function loadSimAnalytics() {
    try {
        const res = await fetch(SimAnalyticsURL, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!res.ok) {
            console.error("Server returned error:", res.status);
            document.getElementById("simRunCount").innerText = "-1";
            return;
        }

        const data = await res.json();
        document.getElementById("simRunCount").innerText = data;

        
    } catch (err) {
        console.error("Failed reading sim analytics:", err);
    }
}

async function loadVisitorsAnalytics() {
    try {
        
        // load visit count as well
        const res = await fetch(VisitorsAnalyticsURL, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!res.ok) {
            console.error("Server returned error:", res.status);
            document.getElementById("visitCount").innerText = "-1";
            return;
        }

        const data = await res.json();
        document.getElementById("visitCount").innerText = data;
    } catch (err) {
        console.error("Failed reading sim analytics:", err);
    }
}

async function checkBackend() {
    const indicator = document.getElementById("backend-indicator");
    const downCard = document.getElementById("backend-down-card");

    try {
        const res = await fetch(backendHealthURL, {
            method: "GET",
            cache: "no-store"
        });

        if (res.ok) {
            // Backend is alive
            indicator.classList.remove("red");
            indicator.classList.add("green");
            downCard.classList.add("hidden");
        } else {
            throw new Error("Non-200 response");
        }
    } catch (err) {
        // Backend offline or waking up
        indicator.classList.remove("green");
        indicator.classList.add("red");
        downCard.classList.remove("hidden");
    }
}



</script>
<script>
// limits number of simulation runs to 100 to prevent browser overload, can be adjusted in the input field attributes and in the backend as well
document.getElementById("sim_runs").addEventListener("input", function () {
    if (this.value > 100) this.value = 100;
    if (this.value < 1) this.value = 1;
});
// restore parameters on page load
window.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll(".sim_input");

    inputs.forEach(input => {
        const saved = localStorage.getItem("simparam_" + input.id);
        if (saved !== null) {
            if (input.type === "number") {
                input.value = Number(saved);
            } else {
                input.value = saved;
            }
        }

        // auto-save on change
        input.addEventListener("input", () => {
            localStorage.setItem("simparam_" + input.id, input.value);
        });
    });
});
</script>
</body>
</html>